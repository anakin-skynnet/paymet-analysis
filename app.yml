# Databricks App execution (app.yaml). Required at project root.
# Docs: https://docs.databricks.com/aws/en/dev-tools/databricks-apps/app-runtime
# App definition (resources, bindings): resources/fastapi_app.yml. When deployed, the platform runs this in source_code_path and proxies traffic to the app.
# Environment variables: defined below in env (not in Compute → Apps → Edit UI). Redeploy bundle to apply changes.
# User auth: open from Compute → Apps → payment-analysis so the platform forwards your token (x-forwarded-access-token).
# Lakebase: LAKEBASE_* below; DATABRICKS_WAREHOUSE_ID from sql-warehouse binding; DATABRICKS_CLIENT_ID/SECRET injected by platform.
command:
  - uvicorn
  - payment_analysis.backend.app:app
  - --host
  - "0.0.0.0"
  - --port
  - "8000"
env:
  - name: PYTHONPATH
    value: src
  # Lakebase Autoscaling (example defaults; override via bundle vars or workspace)
  - name: LAKEBASE_PROJECT_ID
    value: payment-analysis-db
  - name: LAKEBASE_BRANCH_ID
    value: production
  - name: LAKEBASE_ENDPOINT_ID
    value: primary
  # Genie space ID for natural language data queries (Genie Assistant floating dialog).
  # When set, POST /api/agents/chat uses Databricks Genie Conversation API.
  - name: GENIE_SPACE_ID
    value: "01f10700a35c1756a892406b5bab0b67"
  # Use AgentBricks orchestrator for chat (Model Serving). Omit or set empty to use Job 6 (custom Python).
  - name: ORCHESTRATOR_SERVING_ENDPOINT
    value: payment-analysis-orchestrator
  # Lakeview dashboard IDs (must match deployed bundle dashboards for embed to work)
  - name: DASHBOARD_ID_DATA_QUALITY
    value: "01f10a04d1c91e0e80c678988302c684"
  - name: DASHBOARD_ID_ML_OPTIMIZATION
    value: "01f10a04d1d610d58ccf632bbacebdb3"
  - name: DASHBOARD_ID_EXECUTIVE_TRENDS
    value: "01f10a04d1c112afb2581fad5a5c0894"
