# =============================================================================
# Unity Catalog - Schema and Volumes
# =============================================================================
# Schemas: payment_analysis (data, views, ML, agent tools); agents (AgentBricks registered models).
# Catalog and schema names come from variables (default or set at deploy).
# Tables/views are created by Lakeflow and gold view job; ML models by ML job.
# AgentBricks: register LangGraph agents to catalog.agents.* (see job 6 model_registry_*).
# =============================================================================

resources:
  schemas:
    payment_analysis_schema:
      name: ${var.schema}
      catalog_name: ${var.catalog}
      comment: |
        Payment Approval Analysis Platform (${var.environment}).
        Bronze: raw events. Silver: enriched transactions. Gold: v_* analytical views.
        ML models. Agent tool functions (AgentBricks) live here too (catalog.schema.get_*).
      grants:
        - principal: users
          privileges: [USE_SCHEMA, SELECT, EXECUTE]
        - principal: ${workspace.current_user.userName}
          privileges: [ALL_PRIVILEGES]

    agents_schema:
      name: agents
      catalog_name: ${var.catalog}
      comment: |
        AgentBricks registered models (LangGraph agents). Job 6 uses model_registry_catalog.model_registry_schema.
        Register with mlflow.register_model(..., name=f"{catalog}.agents.{agent_name}").
      grants:
        - principal: users
          privileges: [USE_SCHEMA, READ_METADATA, USE_CATALOG]
        - principal: ${workspace.current_user.userName}
          privileges: [ALL_PRIVILEGES]

  volumes:
    raw_data_volume:
      name: raw_data
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      volume_type: MANAGED
      comment: "Landing zone for raw payment data files (CSV, JSON, Parquet)"

    checkpoints_volume:
      name: checkpoints
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      volume_type: MANAGED
      comment: "Checkpoint storage for Structured Streaming and Lakeflow"

    ml_artifacts_volume:
      name: ml_artifacts
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      volume_type: MANAGED
      comment: "ML model artifacts, feature store, and training data"

    reports_volume:
      name: reports
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      volume_type: MANAGED
      comment: "Generated reports, dashboard exports, and analytics outputs"
