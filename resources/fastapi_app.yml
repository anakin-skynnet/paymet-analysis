# Databricks App resource: name, source path, and resource bindings.
# Configuration: https://docs.databricks.com/aws/en/dev-tools/databricks-apps/configuration
# Authorization: https://docs.databricks.com/aws/en/dev-tools/databricks-apps/auth
# Runtime: app.yml at project root (command, env). source_code_path = workspace root (sync destination).
#
# Full configuration: User authorization scopes (below) + App resources listed. Set --var genie_space_id=<uuid> for Genie when deploying.
# Note: Bundle validate may warn on experiment, vector_search_index, function (schema not yet in CLI). If app update fails, add those in Apps UI → Configure → App resources.
# Environment (Workspace → Apps → payment-analysis → Edit → Environment):
#   LAKEBASE_* — Required. DATABRICKS_WAREHOUSE_ID — Required (from sql-warehouse binding).
#   DATABRICKS_CLIENT_ID, DATABRICKS_CLIENT_SECRET — Injected for the app's service principal.

resources:
  apps:
    payment_analysis_app:
      name: payment-analysis
      source_code_path: ${workspace.root_path}
      description: Payment Approval Optimization Platform – dashboards, rules, decisioning, ML models, and agent jobs.
      # User authorization scopes (Users must consent; required for OBO access). See Apps UI → Configure → User authorization.
      user_api_scopes:
        - sql
        - dashboards.genie
        - files.files
        - serving.serving-endpoints
        - vectorsearch.vector-search-indexes
        - catalog.connections
        - catalog.catalogs:read
        - catalog.schemas:read
        - catalog.tables:read
      resources:
        # SQL warehouse — [dev] Payment Analysis Warehouse
        - name: sql-warehouse
          description: SQL warehouse for analytics, app_config, gold views
          sql_warehouse:
            id: ${resources.sql_warehouses.payment_analysis_warehouse.id}
            permission: CAN_USE
        # UC volume — /Volumes/ahs_demos_catalog/payment_analysis/reports
        - name: volume-reports
          description: UC volume for reports and Genie config
          uc_securable:
            securable_type: VOLUME
            securable_full_name: "${var.catalog}.${var.schema}.reports"
            permission: READ_VOLUME
        # Genie: add in Apps UI or set --var genie_space_id=<uuid> and uncomment genie-space block in this file
        # Serving endpoint
        - name: serving-endpoint
          description: Model serving endpoint
          serving_endpoint:
            name: "mas-b6e74e87-endpoint"
            permission: CAN_QUERY
        # experiment, vector_search_index, function: add in Workspace → Apps → payment-analysis → Configure → App resources (bundle schema does not support them yet)
